<!DOCTYPE html>
<html lang="en">

<head>
    <script>if (localStorage.getItem('rs_auth') !== 'authenticated') window.location.href = '/login.html';</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Generator | Red Studio</title>
    <meta name="description" content="Generate secure HLS playback URLs with expiring tokens">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <style>
        main {
            max-width: 540px;
        }

        .page-header {
            text-align: center;
        }

        .generator-card {
            margin-top: 0.5rem;
        }

        .result-section {
            margin-top: 1.5rem;
            display: none;
        }

        .result-section.visible {
            display: block;
        }

        .result-item {
            background: hsl(var(--muted) / 0.3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-label {
            font-size: 0.6875rem;
            font-weight: 600;
            color: hsl(var(--muted-foreground));
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .result-value {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .result-value code {
            flex: 1;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.8125rem;
            color: hsl(var(--foreground));
            word-break: break-all;
            line-height: 1.5;
        }

        .alert {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            background: hsl(var(--warning) / 0.1);
            border: 1px solid hsl(var(--warning) / 0.2);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.8125rem;
            color: hsl(38 92% 35%);
        }

        .alert-icon {
            flex-shrink: 0;
            width: 1.25rem;
            height: 1.25rem;
        }

        .icon-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            background: hsl(var(--primary) / 0.1);
            color: hsl(var(--primary));
            border-radius: 50%;
            margin: 0 auto 1rem;
        }

        .icon-badge svg {
            width: 1.5rem;
            height: 1.5rem;
        }
    </style>
</head>

<body>
    <div class="page-wrapper">
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <a href="/" class="logo">
                    <div class="logo-icon">R</div>
                    <span>Red Studio</span>
                </a>
                <nav class="nav">
                    <a href="/" class="nav-link">Dashboard</a>
                    <a href="/player.html" class="nav-link">Player</a>
                    <a href="/token-generator.html" class="nav-link active">Tokens</a>
                    <a href="/admin.html" class="nav-link">Admin</a>
                    <a href="/stat" class="nav-link" target="_blank">Stats</a>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <div class="container">
                <div class="page-header">
                    <div class="icon-badge">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" />
                        </svg>
                    </div>
                    <h1 class="page-title">Token Generator</h1>
                    <p class="page-description">Generate secure HLS playback URLs with expiring tokens</p>
                </div>

                <div class="card generator-card">
                    <div class="card-body">
                        <div class="form-group mb-4" style="margin-bottom: 1rem;">
                            <label class="form-label">Stream Name</label>
                            <input type="text" class="form-input" id="streamName" value="stream" placeholder="stream">
                        </div>

                        <div class="form-group mb-4" style="margin-bottom: 1rem;">
                            <label class="form-label">Secret Key</label>
                            <input type="password" class="form-input" id="secret" value="hLs_T0k3n_S3cr3t_2024!"
                                placeholder="Must match nginx.conf">
                            <p class="form-hint">This must match the secret in your nginx.conf</p>
                        </div>

                        <div class="form-group mb-4" style="margin-bottom: 1.5rem;">
                            <label class="form-label">Token Expiration</label>
                            <select class="form-input" id="expiration">
                                <option value="3600">1 Hour</option>
                                <option value="86400">24 Hours</option>
                                <option value="604800" selected>7 Days</option>
                                <option value="31536000">1 Year</option>
                            </select>
                        </div>

                        <button class="btn btn-primary btn-lg" style="width: 100%;" onclick="generateToken()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18"
                                height="18">
                                <path
                                    d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" />
                            </svg>
                            Generate Secure URL
                        </button>

                        <div id="result" class="result-section">
                            <div class="result-item">
                                <div class="result-label">HLS Playback URL</div>
                                <div class="result-value">
                                    <code id="urlResult"></code>
                                    <button class="btn btn-secondary btn-sm"
                                        onclick="copyText('urlResult')">Copy</button>
                                </div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Embed URL</div>
                                <div class="result-value">
                                    <code id="embedResult"></code>
                                    <button class="btn btn-secondary btn-sm"
                                        onclick="copyText('embedResult')">Copy</button>
                                </div>
                            </div>
                        </div>

                        <div class="alert">
                            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                <line x1="12" y1="9" x2="12" y2="13" />
                                <line x1="12" y1="17" x2="12.01" y2="17" />
                            </svg>
                            <span>For production use, generate tokens server-side to keep your secret key hidden from
                                clients.</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p class="footer-text">Â© <span id="year"></span> Red Studio. Built with NGINX-RTMP.</p>
        </footer>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12" />
            </svg>
        </div>
        <span class="toast-message" id="toastMessage">Copied!</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        function generateToken() {
            const stream = document.getElementById('streamName').value || 'stream';
            const secret = document.getElementById('secret').value;
            const ttl = parseInt(document.getElementById('expiration').value);

            if (!secret) {
                showToast('Please enter the secret key', 'error');
                return;
            }

            const now = Math.floor(Date.now() / 1000);
            const expires = now + ttl;
            const path = `/hls/${stream}.m3u8`;
            const stringToSign = `${expires}${path} ${secret}`;
            const token = md5(stringToSign);

            const baseUrl = window.location.origin;
            const hlsUrl = `${baseUrl}${path}?md5=${token}&expires=${expires}`;
            const embedUrl = `${baseUrl}/embed.html?stream=${stream}&token=${token}&expires=${expires}`;

            document.getElementById('urlResult').textContent = hlsUrl;
            document.getElementById('embedResult').textContent = embedUrl;
            document.getElementById('result').classList.add('visible');

            showToast('Token generated successfully!');
        }

        function copyText(id) {
            const text = document.getElementById(id).textContent;
            navigator.clipboard.writeText(text);
            showToast('Copied to clipboard!');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
    </script>
</body>

</html>