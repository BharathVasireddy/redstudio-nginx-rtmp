<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U-RL.COM Admin</title>

    <!-- Plyr -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <link rel="stylesheet" href="/admin/admin.css">

</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">U</div>
                <span>U-RL.COM Admin</span>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" id="saveBtn">Save Changes</button>
                <button class="btn btn-primary" id="applyBtn">Save & Apply</button>
                <button class="btn btn-secondary" id="logoutBtn">Logout</button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="cards-row">
            <div class="card">
                <div class="card-header">
                    <h1 class="card-title">Ingest Settings</h1>
                    <p class="card-subtitle">Use this URL and key in OBS or any encoder.</p>
                </div>
                <div class="card-body">
                    <div class="platform-fields" style="grid-template-columns: 1fr;">
                        <div class="field">
                            <label>RTMP Server URL</label>
                            <input id="ingestUrl" readonly>
                        </div>
                        <div class="field">
                            <label>Stream Key</label>
                            <div class="field-input-wrapper">
                                <input id="ingestKey" type="password" placeholder="Generate or enter a key">
                                <button type="button" class="eye-toggle" id="toggleIngestKey" aria-label="Toggle stream key visibility">
                                    <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    <svg class="eye-off-icon" style="display: none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                        <line x1="1" y1="1" x2="23" y2="23"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="platform-controls" style="margin-top: 1rem;">
                        <button class="btn btn-secondary" id="generateKeyBtn" type="button">Generate Key</button>
                        <button class="btn btn-secondary" id="copyKeyBtn" type="button">Copy Key</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h1 class="card-title">Live Preview</h1>
                    <p class="card-subtitle">Monitor your stream in real-time.</p>
                </div>
                <div class="card-body">
                    <div class="preview-player-container">
                        <video id="previewPlayer" playsinline></video>
                        <div class="preview-offline" id="previewOffline">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7" />
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2" />
                            </svg>
                            <span>Stream Offline</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
            <div class="card">
                <div class="card-header">
                    <h1 class="card-title">Live Visibility</h1>
                    <p class="card-subtitle">Control whether the live player appears on the public website.</p>
                </div>
                <div class="card-body">
                    <div class="platform-controls" style="flex-direction: column; align-items: flex-start; gap: 0.75rem;">
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="publicLiveToggle">
                                <span class="slider"></span>
                            </label>
                            <span class="toggle-label" id="publicLiveLabel">Visible on website</span>
                        </div>
                    </div>
                    <p class="card-subtitle" style="margin-top: 0.75rem;">
                        When disabled, the public player shows "Live hidden" even if OBS is streaming.
                    </p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h1 class="card-title">HLS Access Control</h1>
                    <p class="card-subtitle">Control public access to the HLS stream endpoints.</p>
                </div>
                <div class="card-body">
                    <div class="platform-controls" style="flex-direction: column; align-items: flex-start; gap: 0.75rem;">
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="publicHlsToggle">
                                <span class="slider"></span>
                            </label>
                            <span class="toggle-label" id="publicHlsLabel">Allow HLS access</span>
                        </div>
                    </div>
                    <p class="card-subtitle" style="margin-top: 0.75rem;">
                        Disabling HLS blocks `/hls/stream.m3u8`, embeds, and the fallback HLS player (requires Save & Apply).
                    </p>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h1 class="card-title">Overlay Branding</h1>
                <p class="card-subtitle">Burn a logo/image into every output stream. Requires a stream restart after applying.</p>
            </div>
            <div class="card-body">
                <div class="overlay-toolbar">
                    <div class="overlay-toolbar-info">
                        <span class="card-subtitle" style="margin: 0;">
                            PNG with transparency recommended. Overlays render in order (topmost last).
                        </span>
                    </div>
                    <div class="overlay-toolbar-actions">
                        <button class="btn btn-secondary" type="button" id="overlayClearBtn">Clear All</button>
                        <button class="btn btn-primary" type="button" id="overlayAddBtn">Add Overlay</button>
                    </div>
                </div>
                <div id="overlayList" class="overlay-list"></div>
                <div class="overlay-toolbar" style="margin-top: 1rem; margin-bottom: 0;">
                    <span class="card-subtitle" id="overlayLimitNote" style="margin: 0;">
                        More overlays increase CPU usage. Keep the list short for smoother streaming.
                    </span>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h1 class="card-title">Scrolling Ticker</h1>
                <p class="card-subtitle">Add a scrolling text message below the live player.</p>
            </div>
            <div class="card-body">
                <div class="ticker-grid">
                    <div class="ticker-controls">
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="tickerToggle">
                                <span class="slider"></span>
                            </label>
                            <span class="toggle-label" id="tickerLabel">Ticker disabled</span>
                        </div>
                        <div class="field">
                            <label for="tickerBgInput">Ticker background</label>
                            <div class="ticker-color-row">
                                <input type="color" id="tickerBgColor" value="#0f172a">
                                <input type="text" id="tickerBgInput" placeholder="Default gradient">
                                <button class="btn btn-secondary btn-small" type="button" id="tickerBgReset">Default</button>
                            </div>
                            <span class="field-hint">Leave empty to use the default gradient.</span>
                        </div>
                        <div class="field">
                            <label for="tickerSeparatorSelect">Separator between messages</label>
                            <div class="ticker-separator-row">
                                <select id="tickerSeparatorSelect">
                                    <option value="‚Ä¢">Bullet ‚Ä¢</option>
                                    <option value=".">Dot .</option>
                                    <option value="|">Pipe |</option>
                                    <option value="//">Double Slash //</option>
                                    <option value="-">Dash -</option>
                                    <option value="custom">Custom</option>
                                </select>
                                <input type="text" id="tickerSeparatorInput" placeholder="Custom" maxlength="6" disabled>
                            </div>
                            <span class="field-hint">Choose a separator or enter a custom one (max 6 characters).</span>
                        </div>
                        <div class="field">
                            <label for="tickerSpeed">Scroll speed (seconds per loop)</label>
                            <div class="ticker-speed">
                                <input type="range" id="tickerSpeed" min="10" max="120" step="1" value="32">
                                <span id="tickerSpeedValue">32s</span>
                            </div>
                        </div>
                        <div class="field">
                            <label for="tickerFontSize">Text size (px)</label>
                            <div class="ticker-speed">
                                <input type="range" id="tickerFontSize" min="10" max="28" step="1" value="14">
                                <span id="tickerFontSizeValue">14px</span>
                            </div>
                            <span class="field-hint">Recommended 12-18 px for readability.</span>
                        </div>
                        <div class="field">
                            <label for="tickerHeight">Ticker height (px)</label>
                            <div class="ticker-speed">
                                <input type="range" id="tickerHeight" min="28" max="80" step="1" value="40">
                                <span id="tickerHeightValue">40px</span>
                            </div>
                            <span class="field-hint">Increase for a taller ticker bar.</span>
                        </div>
                        <div class="ticker-items-header">
                            <div>
                                <div class="ticker-items-title">Ticker messages</div>
                                <div class="card-subtitle">Add short chunks; they scroll in order.</div>
                            </div>
                            <button class="btn btn-primary btn-small" type="button" id="tickerAddBtn">Add Message</button>
                        </div>
                        <div id="tickerItems" class="ticker-items"></div>
                    </div>
                    <div class="ticker-preview" id="tickerPreview">
                        <div class="ticker-preview-screen">
                            <div class="ticker-preview-badge">LIVE</div>
                            <div class="ticker-preview-caption">Player preview</div>
                            <div class="ticker-preview-frame"></div>
                        </div>
                        <div class="ticker-preview-bar" id="tickerPreviewBar">
                            <div class="ticker-preview-placeholder" id="tickerPreviewPlaceholder">
                                Add a message to preview the scrolling ticker.
                            </div>
                            <div class="ticker-preview-track" id="tickerPreviewTrack">
                                <span class="ticker-preview-item" id="tickerPreviewPrimary"></span>
                                <span class="ticker-preview-item" id="tickerPreviewClone"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h1 class="card-title">Server Health</h1>
                <p class="card-subtitle">CPU, memory, disk, and network usage.</p>
            </div>
            <div class="card-body">
                <div class="metrics-grid" id="metricsGrid">
                    <div class="metric-card">
                        <div class="metric-label">CPU</div>
                        <div class="metric-value" id="cpuValue">--</div>
                        <div class="metric-subvalue" id="cpuSub">Load --</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Memory</div>
                        <div class="metric-value" id="memValue">--</div>
                        <div class="metric-subvalue" id="memSub">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Disk</div>
                        <div class="metric-value" id="diskValue">--</div>
                        <div class="metric-subvalue" id="diskSub">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Network</div>
                        <div class="metric-value" id="netValue">--</div>
                        <div class="metric-subvalue" id="netSub">--</div>
                    </div>
                </div>
                <div class="status" id="metricsStatus" style="margin-top: 0.75rem;"></div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h1 class="card-title">Stream Health Checks</h1>
                <p class="card-subtitle">Warnings for settings that can cause jumps or stutter.</p>
            </div>
            <div class="card-body">
                <ul class="health-list" id="healthList"></ul>
                <div class="status" id="healthStatus" style="margin-top: 0.75rem;"></div>
                <div class="health-meta" id="healthMeta"></div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h1 class="card-title">Embed Options</h1>
                <p class="card-subtitle">Choose how to embed the live stream on external sites.</p>
            </div>
            <div class="card-body">
                <div class="embed-grid">
                    <div class="field">
                        <label>Embed Type</label>
                        <select id="embedType">
                            <option value="full">Full Page (Live UI)</option>
                            <option value="embed">Player Only (Embed)</option>
                            <option value="hls">Direct HLS URL</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>Width</label>
                        <input id="embedWidth" value="100%">
                    </div>
                    <div class="field">
                        <label>Height</label>
                        <input id="embedHeight" value="560">
                    </div>
                </div>

                <div class="embed-options-group">
                    <div class="embed-option">
                        <input type="checkbox" id="embedResponsive" checked>
                        <label for="embedResponsive">Responsive (16:9)</label>
                    </div>
                    <div class="embed-option">
                        <input type="checkbox" id="embedControls" checked>
                        <label for="embedControls">Show Controls</label>
                    </div>
                    <div class="embed-option">
                        <input type="checkbox" id="embedBadge" checked>
                        <label for="embedBadge">Show Live Badge</label>
                    </div>
                    <div class="embed-option">
                        <input type="checkbox" id="embedStats">
                        <label for="embedStats">Show Viewer Count</label>
                    </div>
                    <div class="embed-option">
                        <input type="checkbox" id="embedMuted">
                        <label for="embedMuted">Start Muted</label>
                    </div>
                </div>

                <p class="embed-note">üìã Copy the embed code below and paste it into your website or application.</p>
                <pre class="code-block" id="embedCode"></pre>
                <div class="embed-actions">
                    <button class="btn btn-secondary" id="copyEmbedBtn" type="button">Copy Embed Code</button>
                    <span class="status" id="embedStatus"></span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Multistream Destinations</h1>
                <p class="card-subtitle">Configure RTMP destinations to simultaneously stream to multiple platforms</p>
            </div>
            <div class="card-body">
                <div id="list"></div>
            </div>
            <div class="card-footer">
                <div class="footer-controls">
                    <div class="status" id="status"></div>
                    <label class="reconnect-toggle">
                        <input type="checkbox" id="reconnectToggle" checked>
                        Force stream reconnect after apply
                    </label>
                </div>
                <button class="btn btn-secondary" id="addBtn">+ Add Custom Platform</button>
            </div>
        </div>
    </main>

    <div class="toast-container" id="toastContainer"></div>
    <div class="modal-overlay hidden" id="tickerModal" aria-hidden="true">
        <div class="modal-content ticker-modal">
            <div class="ticker-modal-header">
                <div class="modal-title" id="tickerModalTitle">Add ticker message</div>
                <button class="ticker-modal-close" type="button" id="tickerModalClose" aria-label="Close">
                    √ó
                </button>
            </div>
            <div class="ticker-modal-body">
                <div class="ticker-editor-toolbar">
                    <div class="ticker-emoji-row" id="tickerEmojiRow">
                        <button type="button" data-emoji="üî•">üî•</button>
                        <button type="button" data-emoji="‚úÖ">‚úÖ</button>
                        <button type="button" data-emoji="‚ö°">‚ö°</button>
                        <button type="button" data-emoji="üì£">üì£</button>
                        <button type="button" data-emoji="üéØ">üéØ</button>
                        <button type="button" data-emoji="üí•">üí•</button>
                        <button type="button" data-emoji="üìå">üìå</button>
                        <button type="button" data-emoji="‚≠ê">‚≠ê</button>
                    </div>
                    <div class="ticker-format-row">
                        <button type="button" class="ticker-format-btn" data-action="bold" aria-label="Bold">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="ticker-format-btn" data-action="italic" aria-label="Italic">
                            <em>I</em>
                        </button>
                    </div>
                </div>
                <div class="ticker-editor" id="tickerEditor" contenteditable="true" data-placeholder="Type a ticker message..."></div>
                <div class="ticker-editor-meta">
                    <span id="tickerCharCount">0 chars (recommended 140)</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" type="button" id="tickerModalCancel">Cancel</button>
                <button class="btn btn-primary" type="button" id="tickerModalSave">Save Message</button>
            </div>
        </div>
    </div>

    <script type="module" src="/admin/js/app.js"></script>
    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.13/dist/hls.min.js"></script>
</body>
</html>
